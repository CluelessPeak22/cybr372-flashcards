<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CYBR372 Flashcards — 15+ per Lecture (PDF-sourced)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1620; --card:#121c28; --muted:#7f8da4;
      --text:#e9eef5; --accent:#5eead4; --accent2:#93c5fd; --danger:#fca5a5;
      --ok:#86efac; --chip:#1b2838; --border:#203041;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text); background:linear-gradient(180deg,#0b0f14,#0a121b 80%, #0b0f14);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.3) blur(8px);
      background:rgba(11,15,20,.7); border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px;}
    h1{margin:0; font-size:20px; font-weight:700; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:12.5px}

    .toolbar{
      display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; margin-top:10px;
    }
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      background:var(--panel); padding:10px; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow);
    }
    .controls label{display:flex; gap:8px; align-items:center; background:var(--chip); padding:8px 10px; border-radius:8px; border:1px solid var(--border)}
    .controls input[type="text"], .controls select{
      background:#0b131c; border:1px solid var(--border); color:#fff;
      padding:8px 10px; border-radius:8px; min-width:200px; outline:none;
    }
    .controls .btn{
      background:linear-gradient(180deg,#1b2735,#17202b); border:1px solid var(--border);
      color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; transition:.2s transform, .2s background;
    }
    .controls .btn:hover{transform:translateY(-1px); background:#1d2a39}
    .controls .btn.accent{border-color:#214c4f; background:linear-gradient(180deg,#0e3b3f,#0a2f33); color:#d9fffb}
    .controls .toggle{
      appearance:none; width:38px; height:22px; background:#233345; border-radius:999px; position:relative; outline:none; cursor:pointer; border:1px solid var(--border);
    }
    .controls .toggle:checked{background:#1f6159;border-color:#2a8d84}
    .controls .toggle:before{
      content:""; position:absolute; top:2px; left:2px; width:18px; height:18px; background:#cfd7e3; border-radius:50%; transition:.2s left;
    }
    .controls .toggle:checked:before{left:18px}

    .grid{
      display:grid; grid-template-columns:1fr 360px; gap:16px; margin-top:16px;
    }
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{
      background:radial-gradient(1200px 600px at 100% 0%, rgba(94,234,212,.06), transparent 60%), var(--card);
      border:1px solid var(--border); border-radius:16px; min-height:280px; padding:22px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; cursor:pointer; user-select:none;
      position:relative; isolation:isolate;
    }
    .card .tag{
      position:absolute; top:12px; left:12px; background:#10202b; color:#a6eddd; border:1px solid #204f49; padding:5px 8px; border-radius:999px; font-size:12px;
    }
    .card .q{font-size:20px; font-weight:700; line-height:1.35; letter-spacing:.2px}
    .card .a{margin-top:10px; font-size:16px; color:#d5deeb; display:none}
    .card.revealed .a{display:block}
    .card.revealed .q{opacity:.9}
    .meta{
      display:flex; justify-content:space-between; gap:8px; margin-top:12px; color:var(--muted); font-size:12.5px;
    }
    .side{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:12px; height:100%;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{background:var(--chip); border:1px solid var(--border); color:#cfe8ff; padding:6px 8px; border-radius:999px; font-size:12px; cursor:pointer}
    .chip.active{outline:2px solid var(--accent2); color:#fff}
    .stat{display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted)}
    progress{width:100%; height:10px; accent-color:var(--accent2); background:#0b131c; border-radius:999px}
    .muted{color:var(--muted)}
    .kbd{font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#091017; border:1px solid var(--border); border-bottom-color:#000; color:#cfe8ff; padding:2px 6px; border-radius:6px}
    footer{margin:20px 0 40px; color:var(--muted); text-align:center}
    .tiny{font-size:11px}
    textarea{width:100%; min-height:120px; background:#0b131c; color:#fff; border:1px solid var(--border); border-radius:8px; padding:8px}
    .danger{color:var(--danger)}
    .ok{color:var(--ok)}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>CYBR372 Flashcards — Applied Cryptography</h1>
    <div class="sub">15+ cards guaranteed per lecture. Click the card (or press <span class="kbd">Space</span>/<span class="kbd">Enter</span>) to reveal.</div>
    <div class="toolbar">
      <div class="controls">
        <label title="Shuffle deck when loading / changing filters"><input id="shuffleToggle" type="checkbox" class="toggle" checked> <span>Shuffle on load</span></label>
        <button id="shuffleBtn" class="btn accent">Shuffle now</button>
        <label>Search <input id="searchBox" type="text" placeholder="e.g. DOA vs EA, ECDHE, STARTTLS, RRSIG"></label>
        <label>Topic
          <select id="topicFilter">
            <option value="">All lectures</option>
          </select>
        </label>
        <button id="resetBtn" class="btn">Reset progress</button>
        <button id="exportBtn" class="btn">Export JSON</button>
        <button id="importBtn" class="btn">Import JSON</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section>
      <div id="card" class="card" tabindex="0" aria-live="polite" aria-label="Flashcard">
        <div class="tag" id="tag">Topic</div>
        <div class="q" id="q">Loading…</div>
        <div class="a" id="a"></div>
        <div class="meta">
          <div id="count">0 / 0</div>
          <div id="progressText">0% done</div>
        </div>
      </div>
      <div class="meta" style="margin-top:10px">
        <div>Keys: <span class="kbd">←</span>/<span class="kbd">→</span> prev/next, <span class="kbd">Space</span> reveal, <span class="kbd">S</span> mark known</div>
        <div id="knownStat" class="stat"></div>
      </div>
    </section>

    <aside class="side">
      <div>
        <strong>Lectures</strong>
        <div id="chips" class="chips"></div>
      </div>

      <div>
        <strong>Deck status</strong>
        <div class="stat"><span id="deckSize">0</span> cards in deck</div>
        <progress id="prog" value="0" max="100"></progress>
      </div>

      <div>
        <strong>Import / Export</strong>
        <div class="muted tiny" style="margin-bottom:6px">Export your current deck or import a JSON exported earlier.</div>
        <textarea id="jsonArea" placeholder='Paste deck JSON here to import (or use the Export button)…'></textarea>
        <div style="display:flex; gap:8px; margin-top:6px">
          <button id="applyImport" class="btn">Apply Import</button>
          <span id="importStatus" class="muted tiny"></span>
        </div>
      </div>

      <div class="muted tiny">
        Seeds come from your lecture PDF and Lecture Twenty notes; each lecture is padded to ≥15 using exam-style + short recall variants. ✔️
      </div>
    </aside>
  </div>
</main>

<footer class="wrap tiny">
  © CYBR372 study deck.
</footer>

<script>
/* ------------------------------ Utilities ------------------------------ */
function mulberry32(seed){ return function(){ let t = seed += 0x6D2B79F5; t = Math.imul(t ^ (t>>>15), t | 1); t ^= t + Math.imul(t ^ (t>>>7), t | 61); return ((t ^ (t>>>14)) >>> 0) / 4294967296; } }
function shuffleInPlace(arr, rng=Math.random){ for(let i=arr.length-1;i>0;--i){ const j = Math.floor(rng()* (i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }
function escapeHTML(s){ return (s||"").replace(/[&<>]/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[ch])) }

/* -------------------------- Seed facts per lecture -------------------------- */
/* Each item: {topic, q, a, ref} — topics match lecture titles in your PDF.   */
/* I keep ~5–8 seed facts per lecture; generator pads to ≥15 with mixed styles.*/

const SEEDS = [
  /* Lecture One — Basic Security Services */
  {topic:"Basic Security Services", q:"Define Confidentiality.", a:"Assurance that data cannot be viewed by an unauthorised user.", ref:"L1: Confidentiality"},
  {topic:"Basic Security Services", q:"Define Data Integrity.", a:"Assurance that data has not been altered in an unauthorised manner; it detects alteration rather than preventing it.", ref:"L1: Data Integrity"},
  {topic:"Basic Security Services", q:"Define Data Origin Authentication (DOA).", a:"Assurance that a given entity was the original source of the data (message authentication).", ref:"L1: DOA"},
  {topic:"Basic Security Services", q:"Define Entity Authentication (EA).", a:"Assurance that a given entity is involved and currently active in a communication session.", ref:"L1: EA"},
  {topic:"Basic Security Services", q:"State the relationships DOA→DI and NR→DOA.", a:"DOA is a stronger belief than DI; Non-repudiation implies DOA and thus implies DI.", ref:"L1: Relationships"},
  {topic:"Basic Security Services", q:"Why does confidentiality not imply DOA?", a:"Ciphertext can be modified/rearranged to decrypt to a different valid message; decryption success doesn’t prove origin.", ref:"L1: Conf ⇏ DOA"},

  /* Lecture Two — Introduction to Confidentiality */
  {topic:"Introduction to Confidentiality", q:"Differentiate plaintext and ciphertext.", a:"Plaintext is raw data; ciphertext is the scrambled output of encryption.", ref:"L2: Terminology"},
  {topic:"Introduction to Confidentiality", q:"What does Kerckhoffs’s principle say?", a:"The algorithm should remain secure even if it becomes public; only the key must stay secret.", ref:"L2: Kerckhoffs"},
  {topic:"Introduction to Confidentiality", q:"Contrast encryption vs steganography.", a:"Encryption exposes ciphertext but hides meaning; steganography hides the existence of the message.", ref:"L2: Comparison"},
  {topic:"Introduction to Confidentiality", q:"List common attack models.", a:"Ciphertext-only, known-plaintext, chosen-plaintext, chosen-ciphertext.", ref:"L2: Assumptions"},
  {topic:"Introduction to Confidentiality", q:"What is exhaustive key search?", a:"Trying all keys until plausible plaintext appears; baseline for assessing other attacks.", ref:"L2: Brute force"},

  /* Lecture Three — Perfect vs Practical Secrecy */
  {topic:"Perfect vs Practical Secrecy", q:"Define perfect secrecy.", a:"Ciphertext reveals no extra information about the plaintext beyond prior knowledge.", ref:"L3: Definition"},
  {topic:"Perfect vs Practical Secrecy", q:"Why doesn’t brute force break perfect secrecy?", a:"The definition is information-theoretic: even unbounded adversaries learn nothing from ciphertext.", ref:"L3: Implication"},
  {topic:"Perfect vs Practical Secrecy", q:"What structure achieves perfect secrecy conceptually?", a:"Latin squares / One-Time Pad with truly random one-time keys (XOR).", ref:"L3: Latin Square & OTP"},
  {topic:"Perfect vs Practical Secrecy", q:"Name practical problems with OTP.", a:"Key must be as long as message, uniformly random, used once, and distributed securely.", ref:"L3: Practical Problems"},
  {topic:"Perfect vs Practical Secrecy", q:"Define semantic security informally.", a:"No PPT algorithm given ciphertext can learn non-negligible information about the message.", ref:"L3: Semantic Security"},

  /* Lecture Four — Advanced Encryption Standard (AES) */
  {topic:"Advanced Encryption Standard (AES)", q:"List AES key lengths and block size.", a:"Keys: 128/192/256 bits. Block size: 128 bits (interpreted as 16 bytes).", ref:"L4: AES Attributes"},
  {topic:"Advanced Encryption Standard (AES)", q:"Name two design families contrasted with AES.", a:"Feistel (e.g., DES/3DES) vs substitution-permutation network (AES).", ref:"L4: DES vs AES"},
  {topic:"Advanced Encryption Standard (AES)", q:"Why was DES retired?", a:"56-bit keys succumb to brute force; 3DES was an interim fix with performance cost.", ref:"L4: DES/3DES"},
  {topic:"Advanced Encryption Standard (AES)", q:"Two reasons AES is widely trusted.", a:"Open scrutiny; no practical cryptanalytic breaks; flexible key lengths.", ref:"L4: AES Today"},

  /* Lecture Five — AES Modes of Operation */
  {topic:"AES Modes of Operation", q:"Why avoid ECB for multi-block data?", a:"Equal plaintext blocks encrypt to equal ciphertext blocks (structure leakage).", ref:"L5: ECB"},
  {topic:"AES Modes of Operation", q:"CBC: purpose of IV and secrecy?", a:"Unique/unpredictable IV ensures distinct ciphertexts; IV need not be secret.", ref:"L5: CBC & IV"},
  {topic:"AES Modes of Operation", q:"CBC: 1-bit error propagation effect?", a:"Corrupts an entire plaintext block and flips corresponding bits in the next block.", ref:"L5: CBC Error"},
  {topic:"AES Modes of Operation", q:"Why does CFB ‘decrypt’ using ENC?", a:"The block cipher only generates keystream; ENC used on both sides.", ref:"L5: CFB"},
  {topic:"AES Modes of Operation", q:"CTR: list two properties.", a:"Parallelizable; no error propagation; uses nonce+counter (nonce public).", ref:"L5: CTR"},
  {topic:"AES Modes of Operation", q:"What does GCM add?", a:"Authenticated encryption: confidentiality + authentication tag (AEAD).", ref:"L5: GCM"},

  /* Lecture Six — Cryptographic Hash Functions */
  {topic:"Cryptographic Hash Functions", q:"State three security properties.", a:"Preimage, second preimage, and collision resistance.", ref:"L6: Properties"},
  {topic:"Cryptographic Hash Functions", q:"What is the avalanche effect?", a:"Small input change causes large unpredictable output change.", ref:"L6: Avalanche"},
  {topic:"Cryptographic Hash Functions", q:"Birthday bound for L-bit hash?", a:"≈ 2^(L/2) trials for ~50% collision chance.", ref:"L6: Birthday"},
  {topic:"Cryptographic Hash Functions", q:"One application per property.", a:"Preimage: passwords; 2nd-preimage: downloads; Collision: signatures.", ref:"L6: Applications"},
  {topic:"Cryptographic Hash Functions", q:"Why is SHA-1 deprecated?", a:"Practical chosen-prefix collisions; browsers and platforms phased it out.", ref:"L6: SHA-1 broken"},

  /* Lecture Seven — Message Authentication Codes */
  {topic:"Message Authentication Codes", q:"What does a MAC provide?", a:"Data integrity + data origin authentication using a shared secret key.", ref:"L7: Definition"},
  {topic:"Message Authentication Codes", q:"Define EUF-CMA for MACs.", a:"Unforgeable even with a MAC oracle; cannot produce valid tag for a new message.", ref:"L7: Security"},
  {topic:"Message Authentication Codes", q:"Name two constructions.", a:"HMAC (hash-based) and CMAC (block-cipher-based).", ref:"L7: HMAC/CMAC"},

  /* Lecture Eight — Public Key Encryption / Number Theory */
  {topic:"Public Key Encryption / Number Theory", q:"Two motivators for public-key crypto.", a:"Key distribution at Internet scale; asymmetric trust (sender ≠ receiver).", ref:"L8: Motivation"},
  {topic:"Public Key Encryption / Number Theory", q:"State Fermat’s little theorem.", a:"If p is prime and x not divisible by p, then x^(p−1) ≡ 1 (mod p).", ref:"L8: FLT"},
  {topic:"Public Key Encryption / Number Theory", q:"What is modular inverse?", a:"For a and n (coprime), a·a⁻¹ ≡ 1 (mod n); computed via extended Euclid.", ref:"L8: Mod inverse"},

  /* Lecture Nine — RSA Public Key Cipher */
  {topic:"RSA Public Key Cipher", q:"Outline RSA public key and typical e.", a:"Public key (n,e) with n=p·q; common e=65537.", ref:"L9: RSA setup"},
  {topic:"RSA Public Key Cipher", q:"Why padding (e.g., OAEP) for RSA encryption?", a:"Prevents structural attacks; randomizes plaintext before exponentiation.", ref:"L9: RSA padding"},
  {topic:"RSA Public Key Cipher", q:"What problem underpins RSA security?", a:"Hardness of inverting RSA without d and factoring n.", ref:"L9: Security"},

  /* Lecture Ten — Digital Signatures */
  {topic:"Digital Signatures", q:"Core properties of signatures.", a:"Authenticity, integrity, non-repudiation; anyone can verify with public key.", ref:"L10: Properties"},
  {topic:"Digital Signatures", q:"Signature security notion.", a:"EUF-CMA: existential unforgeability under chosen-message attack.", ref:"L10: EUF-CMA"},

  /* Lecture Eleven — Dig. Sigs, EA, Protocols */
  {topic:"Signatures, Entity Auth & Protocols", q:"How do DOA + freshness give EA?", a:"If origin is known and a fresh challenge is proven, peer is active now.", ref:"L11: Freshness"},
  {topic:"Signatures, Entity Auth & Protocols", q:"Name 3 freshness mechanisms.", a:"Timestamps, sequence numbers, nonces.", ref:"L11: Freshness mechanisms"},

  /* Lecture Twelve — Discrete Logarithm Based PKC */
  {topic:"Discrete Logarithm Based PKC", q:"Give the DH high-level idea.", a:"Exchange values to compute shared secret g^{ab} mod p (or EC).", ref:"L12: DH intro"},
  {topic:"Discrete Logarithm Based PKC", q:"Why safe primes in DH?", a:"Mitigate subgroup attacks; p=2q+1 resists shortcuts.", ref:"L12: Parameters"},
  {topic:"Discrete Logarithm Based PKC", q:"What does ephemeral DH add?", a:"Perfect forward secrecy.", ref:"L12: Ephemeral"},

  /* Lecture Thirteen — Key Management, Certificates & PKI */
  {topic:"PKI / Certificates", q:"Main role of a certificate.", a:"Bind a public key to an identity, vouched by a CA signature.", ref:"L13: Role"},
  {topic:"PKI / Certificates", q:"Chain components.", a:"End-entity leaf + intermediates up to a trusted root.", ref:"L13: Chain"},
  {topic:"PKI / Certificates", q:"Compare PKI vs TOFU vs WoT.", a:"PKI: CA trust; TOFU: first use implicit trust; WoT: user-driven attestations.", ref:"L13: Trust models"},

  /* Lecture Fourteen — TLS / SSL (general) */
  {topic:"TLS / SSL", q:"Purpose of the TLS handshake.", a:"Agree ciphers, authenticate server, derive keys for record protection.", ref:"L14: Purpose"},
  {topic:"TLS / SSL", q:"Record protocol protections.", a:"Confidentiality and integrity (AEAD in modern TLS).", ref:"L14: Record"},

  /* Lecture Fifteen — TLS 1.2 Handshake */
  {topic:"TLS 1.2 Handshake", q:"Role of ClientRandom and ServerRandom.", a:"Freshness nonces mixed into key derivation to prevent replay.", ref:"L15: Randoms"},
  {topic:"TLS 1.2 Handshake", q:"What constitutes the key block?", a:"Client/Server write keys and MAC keys in both directions.", ref:"L15: Key block"},

  /* Lecture Sixteen — Email Security (transport) */
  {topic:"Email Security", q:"Implicit TLS vs STARTTLS.", a:"Implicit: dedicated TLS port from byte one; STARTTLS: plaintext upgraded via command.", ref:"L16: Implicit vs STARTTLS"},
  {topic:"Email Security", q:"Why transport TLS isn’t E2EE.", a:"Hop-by-hop; servers terminate TLS and can read/alter stored plaintext.", ref:"L16: Limitations"},
  {topic:"Email Security", q:"Name two SMTP TLS enforcement tools.", a:"MTA-STS and DANE.", ref:"L16: Enforcement"},

  /* Lecture Seventeen — Tor */
  {topic:"Tor", q:"How Tor provides anonymity.", a:"Layered encryption over 3 hops; each relay knows only neighbors.", ref:"L17: Overview"},
  {topic:"Tor", q:"One Tor limitation at exits.", a:"Exits can see/modify plaintext to the open Internet unless E2EE is used.", ref:"L17: Exit"},

  /* Lecture Eighteen — VPN */
  {topic:"VPN", q:"TLS-VPN vs IPsec distinction.", a:"TLS-VPN at transport/app (443); IPsec at network (transport/tunnel modes).", ref:"L18: TLS vs IPsec"},
  {topic:"VPN", q:"What is encapsulation in a VPN tunnel?", a:"Original packet encrypted and wrapped in a new IP header between gateways.", ref:"L18: Encapsulation"},

  /* Lecture Nineteen — DNSSEC */
  {topic:"DNSSEC", q:"What does DNSSEC provide?", a:"Data origin authentication and integrity for DNS answers.", ref:"L19: Motivation"},
  {topic:"DNSSEC", q:"RRSIG / DNSKEY / DS roles.", a:"RRSIG: signature; DNSKEY: zone’s public key; DS: parent’s pointer to child key.", ref:"L19: Records"},
  {topic:"DNSSEC", q:"Explain the chain of trust.", a:"Parent signs DS for child DNSKEY, anchored at the signed root.", ref:"L19: Chain"},

  /* Lecture Twenty — Email Security: Sender Authentication */
  {topic:"Email Sender Auth", q:"What problem does SPF target?", a:"Authenticating the sending IP for the envelope sender domain via DNS TXT.", ref:"L20: SPF"},
  {topic:"Email Sender Auth", q:"Why is SPF insufficient alone?", a:"Does not validate header From: or preserve content integrity.", ref:"L20: SPF limits"},
  {topic:"Email Sender Auth", q:"What does DKIM add?", a:"Cryptographic signature over headers/body; public key in DNS TXT.", ref:"L20: DKIM"},
  {topic:"Email Sender Auth", q:"List DKIM steps.", a:"Hash headers+body → sign → add header → receiver fetches key → verify.", ref:"L20: DKIM steps"},
  {topic:"Email Sender Auth", q:"What is DMARC alignment and policy?", a:"Header From: must align with authenticated domain; policy none/quarantine/reject; reports.", ref:"L20: DMARC"},
  {topic:"Email Sender Auth", q:"Why DNSSEC matters here?", a:"SPF/DKIM/DMARC rely on DNS TXT; DNSSEC prevents forged DNS replies.", ref:"L20: DNSSEC link"},
  {topic:"Email Sender Auth", q:"Case study: Gmail stance (2024+).", a:"Requires SPF or DKIM; enforces DMARC for bulk senders; rejects non-compliant mail.", ref:"L20: Gmail"},

  /* Lecture Twenty-One — Blockchain & Bitcoin */
  {topic:"Blockchain & Bitcoin", q:"Purpose of proof-of-work.", a:"Sybil-resistant leader election and difficulty-adjusted consensus via hashing puzzles.", ref:"L21: PoW"},
  {topic:"Blockchain & Bitcoin", q:"What is a Bitcoin address (high level)?", a:"Public-key-derived identifier (encodes version + hash + checksum).", ref:"L21: Address"},
  {topic:"Blockchain & Bitcoin", q:"What is in a Bitcoin transaction?", a:"Inputs referencing UTXOs and outputs specifying new locking scripts.", ref:"L21: Tx basics"}
];

/* ---------------------- Generator: pad each lecture to ≥15 ---------------------- */
/* Mix of short recall + exam-style prompts. */
const MIN_PER_TOPIC = 15;

function expandPerTopic(seeds, minPerTopic=MIN_PER_TOPIC){
  const byTopic = new Map();
  seeds.forEach((c, i)=>{ if(!byTopic.has(c.topic)) byTopic.set(c.topic, []); byTopic.get(c.topic).push({...c, __seed:i}); });

  const rng = mulberry32(3722025);
  const out = [];

  const tfPrefix = ["True or False: ","T/F: "];
  const whyPrefix = ["Why is ","What is the purpose of ","Explain why "];
  const howPrefix = ["How does ","Describe how ","Walk through how "];
  const examPrefix = ["EXPLAIN: ","DISCUSS: ","OUTLINE: "];
  const clozePrefix = ["Fill the blank: ","Complete: "];

  const clozeKeys = ["Confidentiality","Integrity","DOA","EA","Non-repudiation","IV","AEAD","CTR","CBC","HMAC","CMAC","ECDHE","OAEP","EUF-CMA","RRSIG","DNSKEY","DS","STARTTLS","MTA-STS","DANE","SPF","DKIM","DMARC","DNSSEC","PFS","PoW","UTXO"];

  function shortClaim(a){ return (a||"").split(/[.;]/)[0].trim(); }
  function subjectify(q){ const s=(q||"").replace(/^(What|Why|How|List|Name|Explain|Describe|Outline|Give|Define)\b.*?\b/gi,'').trim(); return s|| (q||"").replace(/\?$/,''); }
  function clozeFromAnswer(a){
    for(const k of clozeKeys){
      const re = new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");
      if(re.test(a)) return {prompt:a.replace(re,"_____"), answer:`Blank: “${k}”. Full: ${a}`};
    }
    return null;
  }

  for(const [topic, items] of byTopic.entries()){
    // Always include seeds
    items.forEach(x=> out.push(x));

    // Pad with variants until we hit the minimum
    let i = 0;
    while(byTopic.get(topic).length + 0 < minPerTopic){
      const base = items[i % items.length];
      const mode = i % 6;

      if(mode===0){
        // Reverse
        byTopic.get(topic).push({topic, q:`Which term best matches: “${base.a}”`, a: base.q.replace(/\?$/,""), ref: base.ref, type:"Reverse"});
      }else if(mode===1){
        // True/False (true)
        byTopic.get(topic).push({topic, q:`${tfPrefix[Math.floor(rng()*tfPrefix.length)]}${shortClaim(base.a)}`, a:`True — ${base.a}`, ref: base.ref, type:"T/F"});
      }else if(mode===2){
        // Why?
        byTopic.get(topic).push({topic, q:`${whyPrefix[Math.floor(rng()*whyPrefix.length)]+subjectify(base.q)}?`, a: base.a, ref: base.ref, type:"Why"});
      }else if(mode===3){
        // How?
        byTopic.get(topic).push({topic, q:`${howPrefix[Math.floor(rng()*howPrefix.length)]+subjectify(base.q)}?`, a: base.a, ref: base.ref, type:"How"});
      }else if(mode===4){
        // Cloze
        const cl = clozeFromAnswer(base.a);
        if(cl) byTopic.get(topic).push({topic, q:`${clozePrefix[Math.floor(rng()*clozePrefix.length)]}${cl.prompt}`, a:cl.answer, ref:base.ref, type:"Cloze"});
        else byTopic.get(topic).push({topic, q:`In one line: ${base.q}`, a: base.a, ref: base.ref, type:"One-liner"});
      }else{
        // Exam-style prompt
        const exp = `${examPrefix[Math.floor(rng()*examPrefix.length)]}${subjectify(base.q)} — include rationale and an example.`;
        const ans = `${base.a}${base.a.endsWith('.')?'':'.'} Example: ${exampleForTopic(topic, base)}`
        byTopic.get(topic).push({topic, q:exp, a:ans, ref: base.ref, type:"Exam"});
      }
      i++;
    }
    // Append topic’s padded list to out
    const block = byTopic.get(topic);
    block.forEach(x=> out.push(x));
  }
  // De-duplicate (seeds were pushed twice at start/end loop) and return
  const uniq = [];
  const seen = new Set();
  for(const c of out){
    const key = `${c.topic}||${c.q}||${c.a}`;
    if(!seen.has(key)){ seen.add(key); uniq.push(c); }
  }
  return uniq;
}

function exampleForTopic(topic, base){
  switch(topic){
    case "AES Modes of Operation": return "Encrypting two identical blocks under ECB leaks patterns; CBC with unique IV hides them.";
    case "Cryptographic Hash Functions": return "Changing a single bit in a file flips roughly half the bits in a SHA-256 output (avalanche).";
    case "Message Authentication Codes": return "HMAC-SHA256 over API payloads prevents tampering and authenticates the sender.";
    case "PKI / Certificates": return "Browser validates leaf → intermediate → root with EKU checks and revocation.";
    case "TLS 1.2 Handshake": return "ClientHello/ServerHello exchange nonces that feed key derivation.";
    case "Email Sender Auth": return "DMARC ‘reject’ stops look-alike domains that fail alignment with the From: header.";
    case "Tor": return "Only the exit sees cleartext to websites without HTTPS; use HTTPS to protect content.";
    case "VPN": return "In IPsec tunnel mode, a whole inner IP packet is encapsulated and encrypted.";
    case "DNSSEC": return "A resolver validates RRSIG with DNSKEY and walks DS to the root.";
    case "Blockchain & Bitcoin": return "Miners adjust difficulty so average block time remains stable.";
    default: return subjectNoun(base.q);
  }
}
function subjectNoun(q){ return `See: ${q.replace(/\?$/,"")}`; }

/* ------------------------------- Build deck ------------------------------- */
const MINIMUM = MIN_PER_TOPIC;
let FULL_DECK = expandPerTopic(SEEDS, MINIMUM);
const TOPICS = [...new Set(FULL_DECK.map(c=>c.topic))].sort();

/* ------------------------------- UI wiring -------------------------------- */
let VIEW = [];  // filtered & ordered view
let idx = 0;
let known = new Set(JSON.parse(localStorage.getItem("known_ids")||"[]"));

const cardEl = document.getElementById('card');
const qEl = document.getElementById('q');
const aEl = document.getElementById('a');
const tagEl = document.getElementById('tag');
const countEl = document.getElementById('count');
const progEl = document.getElementById('prog');
const progTxt = document.getElementById('progressText');
const knownStat = document.getElementById('knownStat');
const deckSizeEl = document.getElementById('deckSize');
const chipsEl = document.getElementById('chips');
const topicSel = document.getElementById('topicFilter');
const searchBox = document.getElementById('searchBox');

function hydrateTopics(){
  TOPICS.forEach(t=>{
    const opt = document.createElement('option'); opt.value=t; opt.textContent=t; topicSel.appendChild(opt);
    const chip = document.createElement('button'); chip.className='chip'; chip.textContent=t; chip.onclick=()=>{ topicSel.value = (topicSel.value===t ? "" : t); applyFilters(); highlightChips(); }; chipsEl.appendChild(chip);
  });
}
function highlightChips(){
  [...chipsEl.children].forEach(ch=>{
    ch.classList.toggle('active', ch.textContent===topicSel.value && ch.textContent!=="");
  });
}
function normalize(s){ return (s||"").toLowerCase(); }

function applyFilters(){
  const t = topicSel.value;
  const q = normalize(searchBox.value.trim());
  VIEW = FULL_DECK
    .map((c,i)=>({...c, __id:i}))
    .filter(c=> !t || c.topic===t)
    .filter(c=> !q || normalize(c.q).includes(q) || normalize(c.a).includes(q) || normalize(c.ref||"").includes(q));
  if (document.getElementById('shuffleToggle').checked){
    shuffleInPlace(VIEW, mulberry32(173));
  }
  idx = 0;
  render();
}

function render(){
  deckSizeEl.textContent = String(FULL_DECK.length);
  if (!VIEW.length){
    qEl.textContent = "No cards match your filters.";
    aEl.innerHTML = "";
    tagEl.textContent = "—";
    countEl.textContent = "0 / 0";
    progEl.value = 0; progTxt.textContent = "0% done";
    knownStat.textContent = "";
    return;
  }
  const card = VIEW[idx];
  cardEl.classList.remove('revealed');
  qEl.textContent = card.q;
  const src = card.ref ? `<div class="tiny muted" style="margin-top:8px">Source: ${escapeHTML(card.ref)}</div>` : "";
  aEl.innerHTML = `<div style="margin-bottom:10px">${escapeHTML(card.a)}</div>${src}`;
  tagEl.textContent = card.topic;
  countEl.textContent = `${idx+1} / ${VIEW.length}`;
  const knownCount = [...known].filter(id => VIEW.find(v=>v.__id===id)).length;
  const pct = Math.round( (knownCount / VIEW.length) * 100 );
  progEl.value = pct; progTxt.textContent = `${pct}% marked known`;
  knownStat.innerHTML = `Known in view: <span class="ok">${knownCount}</span> / ${VIEW.length}`;
}

function next(){ if (!VIEW.length) return; idx = (idx+1) % VIEW.length; render(); }
function prev(){ if (!VIEW.length) return; idx = (idx-1+VIEW.length) % VIEW.length; render(); }

cardEl.addEventListener('click', ()=>{
  if (!VIEW.length) return;
  cardEl.classList.toggle('revealed');
});
cardEl.addEventListener('keydown', (e)=>{
  if (e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); cardEl.classList.toggle('revealed'); }
  if (e.key === 'ArrowRight'){ e.preventDefault(); next(); }
  if (e.key === 'ArrowLeft'){ e.preventDefault(); prev(); }
  if (e.key.toLowerCase() === 's'){ markKnownCurrent(); }
});

document.getElementById('shuffleBtn').onclick = ()=>{ shuffleInPlace(VIEW, mulberry32(Date.now()&0xffff)); idx=0; render(); };
document.getElementById('resetBtn').onclick = ()=>{ known.clear(); localStorage.setItem("known_ids", JSON.stringify([...known])); render(); };
document.getElementById('exportBtn').onclick = ()=>{
  const data = { deck: FULL_DECK, created: new Date().toISOString() };
  const txt = JSON.stringify(data, null, 2);
  const blob = new Blob([txt], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'cybr372-deck.json'; a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importBtn').onclick = async ()=>{
  const inp = document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
  inp.onchange = async ()=> {
    const f = inp.files[0]; if(!f) return;
    const txt = await f.text();
    try{
      const parsed = JSON.parse(txt);
      if (Array.isArray(parsed.deck)) {
        FULL_DECK = parsed.deck; applyFilters();
        document.getElementById('importStatus').textContent = "Imported deck ✔️";
      } else {
        document.getElementById('importStatus').textContent = "Invalid JSON format.";
      }
    }catch(e){
      document.getElementById('importStatus').textContent = "Parse error.";
    }
  };
  inp.click();
};
document.getElementById('applyImport').onclick = ()=>{
  const txt = document.getElementById('jsonArea').value.trim();
  if (!txt){ document.getElementById('importStatus').textContent = "Paste JSON first."; return; }
  try{
    const parsed = JSON.parse(txt);
    if (Array.isArray(parsed.deck)) {
      FULL_DECK = parsed.deck; applyFilters();
      document.getElementById('importStatus').textContent = "Imported deck ✔️";
    } else {
      document.getElementById('importStatus').textContent = "Invalid JSON format.";
    }
  }catch(e){
    document.getElementById('importStatus').textContent = "Parse error.";
  }
};

document.getElementById('shuffleToggle').onchange = ()=> applyFilters();
topicSel.onchange = ()=>{ applyFilters(); highlightChips(); };
searchBox.oninput = ()=> applyFilters();

function markKnownCurrent(){
  if (!VIEW.length) return;
  const id = VIEW[idx].__id;
  if (known.has(id)) known.delete(id); else known.add(id);
  localStorage.setItem("known_ids", JSON.stringify([...known]));
  render();
}

function init(){
  hydrateTopics();
  highlightChips();
  applyFilters();
  cardEl.focus();
}
init();
</script>
</body>
</html>
