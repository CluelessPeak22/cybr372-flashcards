<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CYBR372 Flashcards — ≥20 per Lecture (PDF-sourced)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1620; --card:#121c28; --muted:#7f8da4;
      --text:#e9eef5; --accent:#5eead4; --accent2:#93c5fd; --danger:#fca5a5;
      --ok:#86efac; --chip:#1b2838; --border:#203041;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text); background:linear-gradient(180deg,#0b0f14,#0a121b 80%, #0b0f14);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.3) blur(8px);
      background:rgba(11,15,20,.7); border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px;}
    h1{margin:0; font-size:20px; font-weight:700; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:12.5px}

    .toolbar{
      display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; margin-top:10px;
    }
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      background:var(--panel); padding:10px; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow);
    }
    .controls label{display:flex; gap:8px; align-items:center; background:var(--chip); padding:8px 10px; border-radius:8px; border:1px solid var(--border)}
    .controls input[type="text"], .controls select{
      background:#0b131c; border:1px solid var(--border); color:#fff;
      padding:8px 10px; border-radius:8px; min-width:200px; outline:none;
    }
    .controls .btn{
      background:linear-gradient(180deg,#1b2735,#17202b); border:1px solid var(--border);
      color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; transition:.2s transform, .2s background;
    }
    .controls .btn:hover{transform:translateY(-1px); background:#1d2a39}
    .controls .btn.accent{border-color:#214c4f; background:linear-gradient(180deg,#0e3b3f,#0a2f33); color:#d9fffb}
    .controls .toggle{
      appearance:none; width:38px; height:22px; background:#233345; border-radius:999px; position:relative; outline:none; cursor:pointer; border:1px solid var(--border);
    }
    .controls .toggle:checked{background:#1f6159;border-color:#2a8d84}
    .controls .toggle:before{
      content:""; position:absolute; top:2px; left:2px; width:18px; height:18px; background:#cfd7e3; border-radius:50%; transition:.2s left;
    }
    .controls .toggle:checked:before{left:18px}

    .grid{
      display:grid; grid-template-columns:1fr 360px; gap:16px; margin-top:16px;
    }
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{
      background:radial-gradient(1200px 600px at 100% 0%, rgba(94,234,212,.06), transparent 60%), var(--card);
      border:1px solid var(--border); border-radius:16px; min-height:280px; padding:22px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; cursor:pointer; user-select:none;
      position:relative; isolation:isolate;
    }
    .card .tag{
      position:absolute; top:12px; left:12px; background:#10202b; color:#a6eddd; border:1px solid #204f49; padding:5px 8px; border-radius:999px; font-size:12px;
    }
    .card .q{font-size:20px; font-weight:700; line-height:1.35; letter-spacing:.2px}
    .card .a{margin-top:10px; font-size:16px; color:#d5deeb; display:none}
    .card.revealed .a{display:block}
    .card.revealed .q{opacity:.9}
    .meta{
      display:flex; justify-content:space-between; gap:8px; margin-top:12px; color:var(--muted); font-size:12.5px;
    }
    .side{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:12px; height:100%;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{background:var(--chip); border:1px solid var(--border); color:#cfe8ff; padding:6px 8px; border-radius:999px; font-size:12px; cursor:pointer}
    .chip.active{outline:2px solid var(--accent2); color:#fff}
    .stat{display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted)}
    progress{width:100%; height:10px; accent-color:var(--accent2); background:#0b131c; border-radius:999px}
    .muted{color:var(--muted)}
    .kbd{font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#091017; border:1px solid var(--border); border-bottom-color:#000; color:#cfe8ff; padding:2px 6px; border-radius:6px}
    footer{margin:20px 0 40px; color:var(--muted); text-align:center}
    .tiny{font-size:11px}
    textarea{width:100%; min-height:120px; background:#0b131c; color:#fff; border:1px solid var(--border); border-radius:8px; padding:8px}
    .danger{color:var(--danger)}
    .ok{color:var(--ok)}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>CYBR372 Flashcards — Applied Cryptography</h1>
    <div class="sub">≥20 cards guaranteed per lecture. Click the card (or press <span class="kbd">Space</span>/<span class="kbd">Enter</span>) to reveal.</div>
    <div class="toolbar">
      <div class="controls">
        <label title="Shuffle deck when loading / changing filters"><input id="shuffleToggle" type="checkbox" class="toggle" checked> <span>Shuffle on load</span></label>
        <button id="shuffleBtn" class="btn accent">Shuffle now</button>
        <label>Search <input id="searchBox" type="text" placeholder="e.g. DOA vs EA, ECDHE, STARTTLS, RRSIG"></label>
        <label>Topic
          <select id="topicFilter">
            <option value="">All lectures</option>
          </select>
        </label>
        <button id="resetBtn" class="btn">Reset progress</button>
        <button id="exportBtn" class="btn">Export JSON</button>
        <button id="importBtn" class="btn">Import JSON</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section>
      <div id="card" class="card" tabindex="0" aria-live="polite" aria-label="Flashcard">
        <div class="tag" id="tag">Topic</div>
        <div class="q" id="q">Loading…</div>
        <div class="a" id="a"></div>
        <div class="meta">
          <div id="count">0 / 0</div>
          <div id="progressText">0% done</div>
        </div>
      </div>
      <div class="meta" style="margin-top:10px">
        <div>Keys: <span class="kbd">←</span>/<span class="kbd">→</span> prev/next, <span class="kbd">Space</span> reveal, <span class="kbd">S</span> mark known</div>
        <div id="knownStat" class="stat"></div>
      </div>
    </section>

    <aside class="side">
      <div>
        <strong>Lectures</strong>
        <div id="chips" class="chips"></div>
      </div>

      <div>
        <strong>Deck status</strong>
        <div class="stat"><span id="deckSize">0</span> cards in deck</div>
        <progress id="prog" value="0" max="100"></progress>
        <div class="tiny muted" id="topicProgress"></div>
      </div>

      <div>
        <strong>Import / Export</strong>
        <div class="muted tiny" style="margin-bottom:6px">Export your current deck or import a JSON exported earlier.</div>
        <textarea id="jsonArea" placeholder='Paste deck JSON here to import (or use the Export button)…'></textarea>
        <div style="display:flex; gap:8px; margin-top:6px">
          <button id="applyImport" class="btn">Apply Import</button>
          <span id="importStatus" class="muted tiny"></span>
        </div>
      </div>

      <div class="muted tiny">
        Cards are sourced from your PDF notes; each lecture is padded to ≥20 with short recall / cloze / T/F variants derived from the same facts. ✔️
      </div>
    </aside>
  </div>
</main>

<footer class="wrap tiny">
  © CYBR372 study deck.
</footer>

<script>
/* ------------------------------ Utilities ------------------------------ */
function mulberry32(seed){ return function(){ let t = seed += 0x6D2B79F5; t = Math.imul(t ^ (t>>>15), t | 1); t ^= t + Math.imul(t ^ (t>>>7), t | 61); return ((t ^ (t>>>14)) >>> 0) / 4294967296; } }
function shuffleInPlace(arr, rng=Math.random){ for(let i=arr.length-1;i>0;--i){ const j = Math.floor(rng()* (i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }
function escapeHTML(s){ return (s||"").replace(/[&<>]/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[ch])) }
function uid(){ return Math.random().toString(36).slice(2) }

/* -------------------------- Seed facts per lecture --------------------------
   Each item: {topic, q, a, ref}. Topics match your PDF lecture titles.
   Existing seeds are preserved; below I’ve appended many new seeds explicitly
   covering your requested areas (Hash functions, TLS, Email, Modes, PKI, etc.).
----------------------------------------------------------------------------- */

const SEEDS = [
  /* Lecture 1 — Basic Security Services */
  {topic:"Basic Security Services", q:"Define Confidentiality.", a:"Assurance that data cannot be viewed by an unauthorised user.", ref:"L1"},
  {topic:"Basic Security Services", q:"Define Data Integrity.", a:"Assurance that data has not been altered in an unauthorised manner; it detects alteration rather than preventing it.", ref:"L1"},
  {topic:"Basic Security Services", q:"Define Data Origin Authentication (DOA).", a:"Assurance that a given entity was the original source of the data (message authentication).", ref:"L1"},
  {topic:"Basic Security Services", q:"Define Entity Authentication (EA).", a:"Assurance that a given entity is involved and currently active in a communication session.", ref:"L1"},
  {topic:"Basic Security Services", q:"Define Non-repudiation.", a:"Assurance that an entity cannot deny a previous commitment or action to a third party.", ref:"L1"},
  {topic:"Basic Security Services", q:"Why does confidentiality not imply DOA?", a:"Ciphertext can be modified to decrypt to another plausible plaintext; decryption success ≠ origin proof.", ref:"L1"},
  {topic:"Basic Security Services", q:"Relationship: DOA vs Data Integrity.", a:"DOA implies Data Integrity; if you can’t verify integrity you can’t bind the origin.", ref:"L1"},
  {topic:"Basic Security Services", q:"Relationship: Non-repudiation vs DOA.", a:"Non-repudiation implies DOA (and thus integrity).", ref:"L1"},
  {topic:"Basic Security Services", q:"Explain DOA vs EA.", a:"DOA authenticates who created the data; EA authenticates who is currently at the other end now.", ref:"L1"},
  {topic:"Basic Security Services", q:"Give an example where EA is required but DOA alone is not enough.", a:"ATM cash withdrawal: need to know the live party is the account holder (EA).", ref:"L1"},
  {topic:"Basic Security Services", q:"State two passive threats and two active threats.", a:"Passive: eavesdropping, traffic analysis. Active: modification, deletion, injection, replay.", ref:"L1"},
  {topic:"Basic Security Services", q:"List non-technical facets a secure system also depends on.", a:"Physical security, processes, human factors, configuration, policies.", ref:"L1"},

  /* Lecture 2 — Introduction to Confidentiality */
  {topic:"Introduction to Confidentiality", q:"Plaintext vs ciphertext.", a:"Plaintext: original data. Ciphertext: encrypted data produced by encryption algorithm and key.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Kerckhoffs’s principle.", a:"Security should reside solely in the key; algorithms can be public.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"List attack models (in increasing power).", a:"Ciphertext-only, known-plaintext, chosen-plaintext, chosen-ciphertext.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Define keyspace.", a:"The set of all possible decryption keys.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Symmetric vs public-key cryptosystem.", a:"Symmetric uses essentially the same key; public-key uses different encryption/decryption keys.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Encryption vs steganography.", a:"Encryption hides meaning; steganography hides existence of the message.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"What does exhaustive key search benchmark?", a:"Baseline feasibility against which smarter attacks are compared.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Why prefer public algorithms over proprietary crypto?", a:"Scrutiny, interoperability, transparency.", ref:"L2"},
  {topic:"Introduction to Confidentiality", q:"Name three side-channel attacks.", a:"Timing, power analysis, fault injection; also padding oracles.", ref:"L2"},

  /* Lecture 3 — Perfect vs Practical Secrecy */
  {topic:"Perfect vs Practical Secrecy", q:"Define perfect secrecy.", a:"Ciphertext reveals no additional information about plaintext beyond prior beliefs.", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"How does the One-Time Pad achieve perfect secrecy?", a:"Truly random key as long as message, used once, combined via XOR.", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"Why is OTP impractical at scale?", a:"Key distribution and storage: keys must be as long as messages and never reused.", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"What is a Latin square property relevant here?", a:"Each ciphertext appears exactly once per row/column, avoiding patterns that leak info.", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"Define semantic security (informal).", a:"No PPT adversary can learn non-negligible information from ciphertext (given length).", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"Polynomial vs exponential time (intuition).", a:"Polynomial is feasible for realistic n; exponential becomes infeasible quickly.", ref:"L3"},
  {topic:"Perfect vs Practical Secrecy", q:"Why doesn’t brute force defeat perfect secrecy?", a:"Even omnipotent adversaries learn nothing statistically from ciphertext alone.", ref:"L3"},

  /* Lecture 4 — AES */
  {topic:"Advanced Encryption Standard (AES)", q:"AES block size and key sizes.", a:"Block: 128 bits; Keys: 128, 192, 256 bits.", ref:"L4"},
  {topic:"Advanced Encryption Standard (AES)", q:"AES design family.", a:"Substitution–permutation network (not Feistel).", ref:"L4"},
  {topic:"Advanced Encryption Standard (AES)", q:"Why was DES deprecated?", a:"56-bit key is brute-forceable; 3DES was a slower interim.", ref:"L4"},
  {topic:"Advanced Encryption Standard (AES)", q:"Two reasons AES is widely trusted.", a:"Open scrutiny; no practical breaks; flexible key lengths; broad HW/SW support.", ref:"L4"},
  {topic:"Advanced Encryption Standard (AES)", q:"Does AES use the same routine for enc/dec?", a:"They’re related but implemented separately (inverse operations for decryption).", ref:"L4"},

  /* Lecture 5 — Modes of Operation */
  {topic:"AES Modes of Operation", q:"Why avoid ECB?", a:"Equal plaintext blocks → equal ciphertext blocks; leaks structure.", ref:"L5"},
  {topic:"AES Modes of Operation", q:"CBC: purpose of IV; must it be secret?", a:"Ensures distinct ciphertexts; must be unique/unpredictable, not secret.", ref:"L5"},
  {topic:"AES Modes of Operation", q:"CBC: error propagation for a 1-bit error.", a:"Ruins the entire block and flips corresponding bits in the next block.", ref:"L5"},
  {topic:"AES Modes of Operation", q:"CFB: why ENC for decryption?", a:"Block cipher is used only to generate keystream; ENC used on both sides.", ref:"L5"},
  {topic:"AES Modes of Operation", q:"CTR: two properties.", a:"Parallelizable; no error propagation; nonce+counter (nonce public).", ref:"L5"},
  {topic:"AES Modes of Operation", q:"GCM adds what?", a:"Authenticated encryption: confidentiality + integrity via auth tag (AEAD).", ref:"L5"},
  /* NEW — Symmetric Key Encryption & Modes (requested) */
  {topic:"AES Modes of Operation", q:"Block cipher vs stream cipher — define and contrast.", a:"Block ciphers transform fixed-size blocks (e.g., AES-128); stream ciphers generate keystream to XOR with plaintext. Modes can turn a block cipher into a stream-like cipher (CTR).", ref:"L5"},
  {topic:"AES Modes of Operation", q:"Describe (in words) CBC encryption steps.", a:"Each plaintext block is XORed with previous ciphertext (or IV) then encrypted with the block cipher under the key.", ref:"L5"},
  {topic:"AES Modes of Operation", q:"State properties of CTR mode.", a:"Requires unique nonce+counter; fully parallelizable; random access; no intrinsic integrity.", ref:"L5"},

  /* Lecture 6 — Hash Functions */
  {topic:"Cryptographic Hash Functions", q:"List three core properties.", a:"Preimage, second preimage, collision resistance.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"Avalanche effect.", a:"Small input change → large unpredictable output change.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"Birthday bound for L-bit hash.", a:"≈2^(L/2) trials for 50% collision chance.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"Example mapping of property→application.", a:"Preimage: passwords; 2nd-preimage: downloads; Collision: signatures.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"Why SHA-1 is deprecated.", a:"Practical chosen-prefix collisions; browsers/platforms phased it out.", ref:"L6"},
  /* NEW — Hash functions (requested) */
  {topic:"Cryptographic Hash Functions", q:"Explain the birthday paradox and its implication for hash security.", a:"Collisions appear around √N trials; for an L-bit hash, ~2^(L/2) attempts find a collision ⇒ pick L large enough (e.g., 256-bit → 128-bit collision strength).", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"How should passwords be stored securely?", a:"Use a slow, salted, memory-hard KDF (e.g., scrypt/Argon2 or PBKDF2) storing salt and parameters with the hash; never store raw hashes or plaintext.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"What does 'storage of hashes themselves' involve?", a:"Protect integrity and access (ACLs, HSM/TPM for keys if HMACed); consider peppering; backup with care to avoid leak of offline attack material.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"List applications of cryptographic hash functions in crypto.", a:"Digital signatures (hash-then-sign), HMAC, commitment schemes, PRFs/DRBGs, Merkle trees, deduplication/fingerprinting.", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"Define preimage, 2nd-preimage, and collision resistance succinctly.", a:"Preimage: hard to find x for given h. Second-preimage: hard to find x'≠x s.t. H(x')=H(x). Collision: hard to find any x≠y with H(x)=H(y).", ref:"L6"},
  {topic:"Cryptographic Hash Functions", q:"(Pseudocode) Simulate a birthday collision search.", a:"Generate random inputs, compute H, track in a map, stop on duplicate digest; complexity ≈2^(L/2).", ref:"L6"},

  /* Lecture 7 — MACs */
  {topic:"Message Authentication Codes", q:"What does a MAC provide?", a:"Integrity and data-origin authentication using a shared secret.", ref:"L7"},
  {topic:"Message Authentication Codes", q:"Security notion for MACs.", a:"EUF-CMA: unforgeable even with MAC oracle access.", ref:"L7"},
  {topic:"Message Authentication Codes", q:"Two constructions.", a:"HMAC (hash-based) and CMAC (block-cipher-based).", ref:"L7"},
  {topic:"Message Authentication Codes", q:"Correctness property.", a:"Verify_k(m, MAC_k(m)) must be true for all m.", ref:"L7"},
  /* NEW — MAC vs Signature (requested) */
  {topic:"Message Authentication Codes", q:"MAC vs Digital Signature — similarities and differences.", a:"Both provide integrity/DOA; MAC uses shared key (no public verifiability, no non-repudiation). Signatures use private/public keys (publicly verifiable, provide non-repudiation).", ref:"L7"},

  /* Lecture 8 — PKC / Number Theory */
  {topic:"Public Key Encryption / Number Theory", q:"Motivation for public-key crypto.", a:"Internet-scale key distribution; asymmetric capabilities.", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Fermat’s little theorem (statement).", a:"For prime p and x not divisible by p: x^(p−1) ≡ 1 (mod p).", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Modular inverse.", a:"For a and n coprime, find a⁻¹ s.t. a·a⁻¹ ≡ 1 (mod n); via extended Euclid.", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Why public keys can be public.", a:"Security rests on hard problems (e.g., factoring, discrete log), not obscurity.", ref:"L8"},
  /* NEW — Public-Key Encryption (requested) */
  {topic:"Public Key Encryption / Number Theory", q:"Public-key vs symmetric-key encryption: main differences.", a:"PKE uses keypairs and is slower; SKE is fast with shared keys. PKE enables key exchange/signatures; SKE used for bulk data.", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Compare efficiency and key lengths for similar security.", a:"PKE keys are much larger (e.g., RSA-2048 ~ AES-112/128); symmetric ciphers are orders faster for bulk encryption.", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Different attacks/assumptions in PKE vs SKE.", a:"PKE: padding oracles, CCA on RSA; assumptions like factoring/DL. SKE: related-key, side-channels, bad modes/IV reuse.", ref:"L8"},
  {topic:"Public Key Encryption / Number Theory", q:"Identify public vs private key in an RSA keypair.", a:"Public key: (n,e). Private key: (n,d) (and often p,q, CRT params).", ref:"L8"},

  /* Lecture 9 — RSA */
  {topic:"RSA Public Key Cipher", q:"RSA public key form.", a:"(n,e) with n=p·q; common e=65537.", ref:"L9"},
  {topic:"RSA Public Key Cipher", q:"Why OAEP for RSA encryption?", a:"Randomizes structure; thwarts deterministic/structure-based attacks.", ref:"L9"},
  {topic:"RSA Public Key Cipher", q:"RSA security rests on…", a:"Hardness of inverting RSA without d and factoring n.", ref:"L9"},
  {topic:"RSA Public Key Cipher", q:"Private key component.", a:"d such that ed ≡ 1 (mod φ(n)).", ref:"L9"},
  /* NEW — Pseudocode (requested ideas) */
  {topic:"RSA Public Key Cipher", q:"(Pseudocode) RSA encryption and decryption.", a:"Encryption: c ≔ m^e mod n. Decryption: m ≔ c^d mod n; with CRT: m ≔ (m_p ⊙ m_q) using q_inv.", ref:"L9"},
  {topic:"RSA Public Key Cipher", q:"Attack on RSA (high level).", a:"Padding oracle / Bleichenbacher on PKCS#1 v1.5; fix by OAEP and constant-time/error discipline.", ref:"L9"},

  /* Lecture 10 — Digital Signatures */
  {topic:"Digital Signatures", q:"Three properties of signatures.", a:"Authenticity, integrity, non-repudiation; public verifiability.", ref:"L10"},
  {topic:"Digital Signatures", q:"Signature security notion.", a:"EUF-CMA (existential unforgeability under chosen-message attack).", ref:"L10"},
  {topic:"Digital Signatures", q:"Why hash-then-sign?", a:"Efficiency and fixed-size input to the signing primitive; binding to message.", ref:"L10"},
  /* NEW — Pseudocode */
  {topic:"Digital Signatures", q:"(Pseudocode) Forgery attempt on a weak signature scheme.", a:"Chosen-message attack to derive structure/collision; demonstrate on flawed hash or malleable scheme; mitigation: strong hash + proper domain separation.", ref:"L10"},

  /* Lecture 11 — Signatures, EA, Protocols */
  {topic:"Signatures, Entity Auth & Protocols", q:"How DOA + freshness ⇒ EA?", a:"Origin known + freshness proof shows the peer is actively participating now.", ref:"L11"},
  {topic:"Signatures, Entity Auth & Protocols", q:"Three freshness mechanisms.", a:"Timestamps, sequence numbers, nonces.", ref:"L11"},
  {topic:"Signatures, Entity Auth & Protocols", q:"Give an example of challenge-response EA.", a:"Prover signs a fresh nonce from verifier; verifier checks signature.", ref:"L11"},

  /* Lecture 12 — Discrete Logarithm Based PKC */
  {topic:"Discrete Logarithm Based PKC", q:"High-level DH idea.", a:"Exchange public values to compute shared secret g^{ab} mod p (or EC).", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"Why ‘safe primes’ in DH?", a:"Mitigate small-subgroup attacks; p=2q+1.", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"What does ephemeral DH add?", a:"Perfect forward secrecy.", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"Discrete log problem (informal).", a:"Given g, p, and g^x mod p, find x; believed hard for suitable groups.", ref:"L12"},
  /* NEW — Diffie–Hellman (requested) */
  {topic:"Discrete Logarithm Based PKC", q:"How does DH key agreement work (plain)?", a:"Parties choose secrets a,b; exchange A=g^a, B=g^b; both compute K=g^{ab} mod p.", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"Why does DH work (intuition)? Risks and fixes.", a:"Exponent laws yield same secret; risks: MITM, small-subgroup; fixes: authentication (certs/PSK), parameter validation, safe primes.", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"Normal DH vs ECDH vs ECDHE.", a:"ECDH uses elliptic curves (smaller keys, faster). ECDHE adds ephemerality ⇒ forward secrecy.", ref:"L12"},
  {topic:"Discrete Logarithm Based PKC", q:"(Pseudocode) Key agreement through DHE.", a:"Setup p,g; pick a,b; compute A,B; verify params; compute K; derive keys with KDF.", ref:"L12"},

  /* Lecture 13 — PKI / Certificates */
  {topic:"PKI / Certificates", q:"Purpose of a certificate.", a:"Bind a public key to an identity via CA signature.", ref:"L13"},
  {topic:"PKI / Certificates", q:"Chain components.", a:"Leaf + intermediates up to a trusted root.", ref:"L13"},
  {topic:"PKI / Certificates", q:"Trust models: PKI vs TOFU vs WoT.", a:"PKI=CA trust; TOFU=first-use trust; WoT=user attestations.", ref:"L13"},
  {topic:"PKI / Certificates", q:"What does revocation try to solve?", a:"Invalidate previously trusted certs (CRLs/OCSP).", ref:"L13"},
  /* NEW — Certificates / PKI (requested) */
  {topic:"PKI / Certificates", q:"Main role of a public key certificate and how achieved.", a:"Authenticate binding of subject identity to a public key via CA’s digital signature.", ref:"L13"},
  {topic:"PKI / Certificates", q:"Main components of an X.509 certificate.", a:"Subject, SubjectPublicKeyInfo, Issuer, Serial, Validity, Extensions (SAN, KU/EKU), Signature (alg + value).", ref:"L13"},
  {topic:"PKI / Certificates", q:"Validation steps for a public key certificate.", a:"Build chain to a trusted root; verify signatures; check validity period, revocation, key usage, name/SAN matches hostname.", ref:"L13"},
  {topic:"PKI / Certificates", q:"Root vs intermediate vs leaf certificates.", a:"Root is self-signed trust anchor; intermediates are CA-signed to delegate trust; leaf identifies end-entity (server/client/code).", ref:"L13"},
  {topic:"PKI / Certificates", q:"Certificate stores and where they live.", a:"OS/browser trust stores contain roots; apps often rely on OS (Windows, macOS Keychain, NSS).", ref:"L13"},
  {topic:"PKI / Certificates", q:"Applications of certificates.", a:"TLS server/client auth, S/MIME, code/document signing, VPNs, device identity (802.1X).", ref:"L13"},
  {topic:"PKI / Certificates", q:"(Pseudocode) Certificate verification (high level).", a:"Input chain; for each: verify signature; enforce policies; check revocation; ensure name matches target; accept only if a trust anchor reached.", ref:"L13"},

  /* Lecture 14 — TLS / SSL */
  {topic:"TLS / SSL", q:"Purpose of TLS handshake.", a:"Agree ciphers, authenticate server, derive keys for record protection.", ref:"L14"},
  {topic:"TLS / SSL", q:"Record protocol protections.", a:"Confidentiality and integrity (AEAD in modern TLS).", ref:"L14"},
  {topic:"TLS / SSL", q:"What is SNI used for?", a:"Client indicates target hostname to pick correct certificate/key.", ref:"L14"},
  /* NEW — TLS (requested) */
  {topic:"TLS / SSL", q:"List TLS 1.3 handshake messages and purpose.", a:"ClientHello (params, key share), ServerHello (selects suite, key share), EncryptedExtensions, Certificate(+Verify), Finished (key confirmation).", ref:"L14"},
  {topic:"TLS / SSL", q:"Client actions in TLS handshake and rationale.", a:"Offer versions/cipher suites, send key share, verify server cert/Finished, send its Finished; optionally send client cert.", ref:"L14"},
  {topic:"TLS / SSL", q:"Server actions in TLS handshake and rationale.", a:"Select suite, send key share, send cert and proof (CertificateVerify), send Finished; optionally request client auth.", ref:"L14"},
  {topic:"TLS / SSL", q:"High-level steps of the TLS handshake.", a:"Hello exchange → key agreement → server auth → key confirmation → (optional client auth) → protected data.", ref:"L14"},
  {topic:"TLS / SSL", q:"Security of TLS handshake: what prevents MITM?", a:"Certificate validation, signatures over transcript (CertificateVerify) and Finished MAC key confirmation.", ref:"L14"},
  {topic:"TLS / SSL", q:"Differences between TLS 1.2 and 1.3.", a:"1.3 removes static RSA/DSA, mandates (EC)DHE+AEAD, 0-RTT option, simpler ciphersuites, encrypts more of the handshake.", ref:"L14"},
  {topic:"TLS / SSL", q:"TLS vs QUIC.", a:"QUIC uses TLS 1.3 for crypto but runs over UDP with built-in transport (streams, loss recovery); handshake integrated with transport; faster resumption/0-RTT.", ref:"L14"},
  {topic:"TLS / SSL", q:"Ciphersuite properties to identify.", a:"Key exchange (ECDHE), authentication (RSA/ECDSA/EdDSA), bulk (AES-GCM/ChaCha20-Poly1305), key lengths, AEAD mode.", ref:"L14"},
  {topic:"TLS / SSL", q:"Forward secrecy — define and how TLS achieves it.", a:"Compromise of long-term keys does not reveal past session keys; achieved with ephemeral (EC)DHE.", ref:"L14"},
  {topic:"TLS / SSL", q:"(Pseudocode) TLS 1.3 client-side handshake (outline).", a:"Build ClientHello with key share; receive ServerHello; derive secrets (HKDF); verify Certificate/Finished; send Finished; switch to application keys.", ref:"L14"},

  /* Lecture 15 — TLS 1.2 Handshake */
  {topic:"TLS 1.2 Handshake", q:"Role of ClientRandom and ServerRandom.", a:"Fresh nonces mixed into key derivation to prevent replay.", ref:"L15"},
  {topic:"TLS 1.2 Handshake", q:"What is the ‘key block’?", a:"Client/Server write keys and integrity keys for both directions.", ref:"L15"},
  {topic:"TLS 1.2 Handshake", q:"Why ephemeral (EC)DHE in TLS?", a:"Provides forward secrecy.", ref:"L15"},

  /* Lecture 16 — Email Security (transport) */
  {topic:"Email Security", q:"Implicit TLS vs STARTTLS.", a:"Implicit: dedicated TLS from byte 1. STARTTLS: plaintext upgraded via command.", ref:"L16"},
  {topic:"Email Security", q:"Why transport TLS isn’t E2EE.", a:"Hop-by-hop; servers can read and store plaintext.", ref:"L16"},
  {topic:"Email Security", q:"Two SMTP TLS enforcement tools.", a:"MTA-STS and DANE.", ref:"L16"},
  {topic:"Email Security", q:"PGP vs S/MIME (very high level).", a:"Both E2EE: PGP web-of-trust, S/MIME uses X.509/PKI.", ref:"L16"},
  /* NEW — Email Security (requested) */
  {topic:"Email Security", q:"Implicit vs explicit TLS: SMTPS (465) vs SMTP with STARTTLS (587/25).", a:"SMTPS uses TLS from start on a dedicated port; STARTTLS upgrades an existing plaintext session after EHLO.", ref:"L16"},
  {topic:"Email Security", q:"SPF: how it works and what it provides.", a:"DNS TXT lists authorised sending IPs for a domain; receivers check connecting host IP ⇒ prevents spoofing of envelope sender, not message integrity/content.", ref:"L16"},
  {topic:"Email Security", q:"DKIM: how it works and what it provides.", a:"Sending domain signs selected headers/body; receivers fetch public key via DNS to verify ⇒ domain-level DOA and integrity across relays.", ref:"L16"},
  {topic:"Email Security", q:"DMARC: how it works and what it provides.", a:"Policy published in DNS aligning SPF/DKIM with header From; receivers apply policy (none/quarantine/reject) and send reports.", ref:"L16"},
  {topic:"Email Security", q:"How to achieve real E2EE for email.", a:"Encrypt/sign at the endpoints with OpenPGP or S/MIME; manage keys (WoT or PKI); messages remain opaque to intermediaries.", ref:"L16"},

  /* Lecture 17 — Tor */
  {topic:"Tor", q:"How Tor provides anonymity.", a:"Layered encryption over 3 hops; each relay knows only neighbors.", ref:"L17"},
  {topic:"Tor", q:"Exit node limitation.", a:"Exits see plaintext to the open Internet unless E2EE is used.", ref:"L17"},
  {topic:"Tor", q:"Does Tor give integrity/confidentiality end-to-end?", a:"Only within circuit; to destination use TLS/HTTPS for E2EE.", ref:"L17"},
  /* NEW — Tor (requested) */
  {topic:"Tor", q:"What service does Tor provide and why it works (intuition)?", a:"Traffic-relay anonymity via onion routing and path diversity; hides source IP from destination and vice versa (with limitations).", ref:"L17"},
  {topic:"Tor", q:"Key limitations of Tor.", a:"Global adversaries, website fingerprinting, malicious exits, performance/latency.", ref:"L17"},

  /* Lecture 18 — VPN */
  {topic:"VPN", q:"TLS-VPN vs IPsec.", a:"TLS-VPN at transport/app; IPsec at network (transport/tunnel modes).", ref:"L18"},
  {topic:"VPN", q:"Encapsulation meaning.", a:"Original packet encrypted and wrapped in a new IP header between gateways.", ref:"L18"},
  {topic:"VPN", q:"IPsec AH vs ESP.", a:"AH provides integrity/auth but no confidentiality; ESP provides encryption (can also auth).", ref:"L18"},
  /* NEW — VPN (requested) */
  {topic:"VPN", q:"Concept/purpose of a VPN vs related tech.", a:"Creates an encrypted tunnel over untrusted networks for private connectivity; differs from Tor (anonymity) and TLS (app-level).", ref:"L18"},
  {topic:"VPN", q:"Encapsulation/decapsulation for TLS-VPN vs IPsec.", a:"TLS-VPN wraps TCP/UDP payloads in TLS; IPsec ESP tunnels entire IP packet (tunnel mode) or protects transport payload (transport mode).", ref:"L18"},
  {topic:"VPN", q:"Applications and limitations of VPNs.", a:"Corp remote access, site-to-site, geo access; limitations: trust in provider, metadata leakage, split-tunnel risks, performance.", ref:"L18"},
  {topic:"VPN", q:"Role of cryptography in VPNs.", a:"Key exchange (TLS or IKE), symmetric encryption (AES/ChaCha), integrity (HMAC/AEAD), certs/PSKs for auth.", ref:"L18"},
  {topic:"VPN", q:"(Pseudocode) IPsec tunnel encapsulation (outline).", a:"Take IP packet → ESP: add header, encrypt payload, add auth tag; outer IP header added; reverse on decap.", ref:"L18"},

  /* Lecture 19 — DNSSEC */
  {topic:"DNSSEC", q:"What does DNSSEC provide?", a:"Data origin authentication and integrity for DNS answers; not confidentiality.", ref:"L19"},
  {topic:"DNSSEC", q:"Name DNSSEC record types.", a:"RRSIG, DNSKEY, DS, NSEC/NSEC3.", ref:"L19"},
  {topic:"DNSSEC", q:"DANE (at a glance).", a:"TLSA records bind TLS keys/certs to DNS with DNSSEC validation.", ref:"L19"},
  /* NEW — DNSSEC (requested) */
  {topic:"DNSSEC", q:"How does DNSSEC provide its service and what are limitations?", a:"Chains of signatures from zone to root; resolvers validate. Limitations: no confidentiality, deployment gaps, NSEC privacy trade-offs.", ref:"L19"},
  {topic:"DNSSEC", q:"How DNSSEC ties to other services.", a:"Enables DANE (TLSA for TLS, SMIMEA for email), SSHFP validation, mitigating MX downgrade.", ref:"L19"},

  /* Lecture 20 — Email Sender Authentication */
  {topic:"Email Sender Authentication", q:"What does SPF do?", a:"Authorizes sending IPs for a domain via DNS TXT; combats spoofing.", ref:"L20"},
  {topic:"Email Sender Authentication", q:"What does DKIM provide?", a:"Domain-based signing of mail headers/body; receiver verifies with DNS key.", ref:"L20"},
  {topic:"Email Sender Authentication", q:"What is DMARC for?", a:"Aligns SPF/DKIM with ‘From’ domain and sets receiver policy (none/quarantine/reject).", ref:"L20"},

  /* Lecture 21 — Blockchain & Bitcoin (overview) */
  {topic:"Blockchain & Bitcoin", q:"Hash-linked blockchain idea.", a:"Blocks chained by previous hash; tampering breaks links.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"Proof-of-work purpose.", a:"Sybil-resistant consensus by making block creation costly.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"What’s a UTXO?", a:"Unspent transaction output model for tracking spendable coins.", ref:"L21"},
  /* NEW — Blockchain (requested) */
  {topic:"Blockchain & Bitcoin", q:"Core blockchain properties.", a:"Append-only ledger, distributed consensus, tamper-evident via hashes, eventual consistency.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"Bitcoin address (high level).", a:"Derived from a public key via hashing (e.g., HASH160) and encoded (Base58Check).", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"Bitcoin transaction structure.", a:"Inputs reference previous UTXOs with scriptSig; outputs define scriptPubKey and amounts; fees = inputs − outputs.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"scriptSig vs scriptPubKey.", a:"scriptPubKey sets spending conditions; scriptSig provides data to satisfy them at spend time.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"How proof-of-work works.", a:"Miners vary nonce to find block header hash below target; difficulty adjusts to target interval.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"Purpose of mining.", a:"Secure consensus, order transactions, mint new coins via block subsidy + fees.", ref:"L21"},
  {topic:"Blockchain & Bitcoin", q:"(Pseudocode) Send a Bitcoin transaction (simplified).", a:"Select UTXOs → build tx → sign inputs → broadcast → wait for confirmations.", ref:"L21"}
];

/* ------------------------- Auto-augmentation engine -------------------------
   Ensures ≥20 per lecture without removing any originals.
   Templates keep content faithful to seeds (cloze/T-F/why/contrast/rephrase).
----------------------------------------------------------------------------- */

const MIN_PER_TOPIC = 20;

function toCloze(text){
  const words = text.split(/\s+/);
  if(words.length < 3) return {q:`Fill in the blank: ${text}`, a:text};
  const idx = Math.max(0, Math.min(words.length-1, Math.floor(words.length/2)));
  const removed = words.slice(idx, idx+Math.min(2, words.length-idx)).join(" ");
  const q = `Fill in the blank: ${words.slice(0,idx).join(" ")} <u>____</u> ${words.slice(idx+Math.min(2, words.length-idx)).join(" ")}`.replace(/\s+/g," ").trim();
  return {q, a:`${removed}`.trim()};
}
function asTrueFalse(seed){
  const s = seed.q.replace(/^\s*(what|why|when|how|define|list|name|state)\b.*?\??\s*/i,'').trim();
  const stmt = (s ? `${capitalize(s.replace(/\.$/,''))}.` : `${seed.a.replace(/\.$/,'')}.`);
  const truth = true;
  return {q:`True or False: ${stmt}`, a:`True — ${seed.a}`};
}
function asContrast(seed){
  if(/vs|compare|contrast/i.test(seed.q)) return null;
  if(seed.a.includes(';') || seed.a.includes(' vs ')){
    return {q:`Contrast the two sides in: ${seed.q}`, a:seed.a};
  }
  return null;
}
function whyMatters(seed){
  return {q:`Why does this matter? → ${seed.q}`, a:seed.a};
}
function rephraseShort(seed){
  let head = seed.q.replace(/\?+$/,'').trim();
  head = head.length>80 ? head.slice(0,77)+'…' : head;
  return {q:`Recall: ${head}?`, a:seed.a};
}
function capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1)}

function generateVariantsForSeed(seed){
  const variants = [];
  variants.push(toCloze(seed.a));
  variants.push(asTrueFalse(seed));
  variants.push(whyMatters(seed));
  variants.push(rephraseShort(seed));
  const c = asContrast(seed); if(c) variants.push(c);
  return variants.map(v=>({topic:seed.topic, q:v.q, a:v.a, ref:seed.ref, derivedFrom:seed.q}));
}

function ensureMinPerTopic(seeds, minPerTopic=MIN_PER_TOPIC){
  const byTopic = {};
  for(const s of seeds){
    (byTopic[s.topic] ||= []).push(s);
  }
  const out = [];
  for(const topic of Object.keys(byTopic)){
    const originals = byTopic[topic].slice();
    const pool = originals.slice();
    let i = 0;
    while(pool.length < minPerTopic){
      const src = originals[i % originals.length];
      const vs = generateVariantsForSeed(src);
      for(const v of vs){
        if(pool.length >= minPerTopic) break;
        if(!pool.some(p=>p.q===v.q)){
          pool.push(v);
        }
      }
      i++;
      if(i>5000) break;
    }
    out.push(...pool);
  }
  return out;
}

/* ------------------------------ Deck building ------------------------------ */

let MASTER = ensureMinPerTopic(SEEDS, MIN_PER_TOPIC);

const TOPICS = [...new Set(MASTER.map(x=>x.topic))]
  .sort((a,b) => getLectureNumberForTopic(a) - getLectureNumberForTopic(b));


let deck = [];
let idx = 0;
let rng = Math.random;
let known = new Set(JSON.parse(localStorage.getItem('known')||'[]'));
let currentFilter = '';
let currentSearch = '';

function updateRng(){
  const shuffleOn = document.getElementById('shuffleToggle').checked;
  rng = shuffleOn ? mulberry32(Date.now()>>>0) : Math.random;
}

function rebuildDeck(){
  const topic = currentFilter;
  const search = currentSearch.toLowerCase();
  deck = MASTER.filter(c => (!topic || c.topic===topic) && (!search || (c.q.toLowerCase().includes(search) || c.a.toLowerCase().includes(search))));
  updateRng();
  shuffleInPlace(deck, rng);
  idx = 0;
  updateTopicProgress();
  renderCard();
  updateSidebar();
}

function updateSidebar(){
  // Deck size
  document.getElementById('deckSize').textContent = deck.length;

  // Chips (left panel)
  document.getElementById('chips').innerHTML = TOPICS.map(t=>{
    const active = (t===currentFilter) ? 'active' : '';
    return `<div class="chip ${active}" data-topic="${escapeHTML(t)}">${escapeHTML(formatLectureLabel(t))}</div>`;
  }).join('');

  // Dropdown (toolbar)
  const select = document.getElementById('topicFilter');
  select.innerHTML = `<option value="">All lectures</option>` + TOPICS.map(t=>{
    const sel = (t===currentFilter)?' selected':'';
    return `<option value="${escapeHTML(t)}"${sel}>${escapeHTML(formatLectureLabel(t))}</option>`;
  }).join('');
}


function renderCard(){
  const qEl = document.getElementById('q');
  const aEl = document.getElementById('a');
  const tag = document.getElementById('tag');
  const card = document.getElementById('card');
  if(deck.length===0){
    qEl.textContent = "No cards match your filters.";
    aEl.textContent = "";
    card.classList.remove('revealed');
    document.getElementById('count').textContent = `0 / 0`;
    document.getElementById('progressText').textContent = `0% done`;
    document.getElementById('prog').value = 0;
    document.getElementById('knownStat').innerHTML = '';
    tag.textContent = '—';
    return;
  }
  const c = deck[idx];
  qEl.innerHTML = escapeHTML(c.q);
  aEl.innerHTML = escapeHTML(c.a);
  tag.textContent = c.topic;
  const id = cardId(c);
  card.classList.toggle('revealed', known.has(id));
  document.getElementById('count').textContent = `${idx+1} / ${deck.length}`;
  const pct = Math.round((Array.from(known).filter(k=> deck.some(d=>cardId(d)===k)).length / deck.length)*100);
  document.getElementById('progressText').textContent = `${pct}% done`;
  document.getElementById('prog').value = pct;
  const knownInTopic = Array.from(known).filter(k=>{
    const m = MASTER.find(d=>cardId(d)===k);
    return m && (!currentFilter || m.topic===currentFilter);
  }).length;
  document.getElementById('knownStat').innerHTML = `<span class="${pct===100?'ok':''}">${knownInTopic}</span> known in current filter`;
}

function cardId(c){ return c.topic+'|'+c.q+'|'+(c.derivedFrom||'') }

function markKnown(toggle=true){
  if(deck.length===0) return;
  const id = cardId(deck[idx]);
  if(toggle){
    if(known.has(id)) known.delete(id); else known.add(id);
  }else{
    known.add(id);
  }
  localStorage.setItem('known', JSON.stringify(Array.from(known)));
  renderCard();
}

function next(){ if(deck.length===0) return; idx=(idx+1)%deck.length; renderCard() }
function prev(){ if(deck.length===0) return; idx=(idx-1+deck.length)%deck.length; renderCard() }

function updateTopicProgress(){
  const counts = {};
  for(const t of TOPICS) counts[t]=0;
  for(const c of MASTER) counts[c.topic]++;
  const txt = TOPICS.map(t=>`${t}: ${counts[t]}`).join(' • ');
  document.getElementById('topicProgress').textContent = txt;
}

function getLectureNumberForTopic(topic){
  // find the first seed for this topic and read ref like "L14"
  const s = MASTER.find(x => x.topic === topic && /^L\d+/.test(x.ref||""));
  if(!s) return Infinity; // topics without an L# go last
  const m = (s.ref || "").match(/^L(\d+)/);
  return m ? parseInt(m[1], 10) : Infinity;
}
function formatLectureLabel(topic){
  const n = getLectureNumberForTopic(topic);
  if(!isFinite(n)) return topic;
  return `L${String(n).padStart(2,'0')} — ${topic}`;
}



/* ------------------------------- UI wiring -------------------------------- */
window.addEventListener('DOMContentLoaded', ()=>{
  updateSidebar();
  rebuildDeck();

  const card = document.getElementById('card');
  card.addEventListener('click', ()=> card.classList.toggle('revealed'));

  document.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight'){ next(); e.preventDefault(); }
    else if(e.key==='ArrowLeft'){ prev(); e.preventDefault(); }
    else if(e.key===' ' || e.key==='Enter'){ document.getElementById('card').classList.toggle('revealed'); e.preventDefault(); }
    else if(e.key==='s' || e.key==='S'){ markKnown(); }
  });

  document.getElementById('shuffleBtn').addEventListener('click', ()=>{ shuffleInPlace(deck, mulberry32(Date.now()>>>0)); idx=0; renderCard(); });
  document.getElementById('shuffleToggle').addEventListener('change', ()=> rebuildDeck());
  document.getElementById('searchBox').addEventListener('input', (e)=>{ currentSearch=e.target.value; rebuildDeck(); });
  document.getElementById('topicFilter').addEventListener('change', (e)=>{ currentFilter=e.target.value||''; rebuildDeck(); });

  document.getElementById('chips').addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip');
    if(!chip) return;
    const t = chip.getAttribute('data-topic');
    currentFilter = (currentFilter===t) ? '' : t;
    rebuildDeck();
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    if(confirm('Reset known/seen progress?')){ known.clear(); localStorage.removeItem('known'); renderCard(); }
  });

  document.getElementById('exportBtn').addEventListener('click', ()=>{
    const payload = { version:1, date:new Date().toISOString(), known:Array.from(known), seeds:SEEDS, deck:MASTER };
    const json = JSON.stringify(payload, null, 2);
    document.getElementById('jsonArea').value = json;
  });
  document.getElementById('importBtn').addEventListener('click', ()=>{
    document.getElementById('jsonArea').focus();
    document.getElementById('jsonArea').select();
  });
  document.getElementById('applyImport').addEventListener('click', ()=>{
    const status = document.getElementById('importStatus');
    try{
      const data = JSON.parse(document.getElementById('jsonArea').value);
      if(data.known){ known = new Set(data.known); localStorage.setItem('known', JSON.stringify(Array.from(known))); }
      if(data.seeds && Array.isArray(data.seeds)){
        const merged = [...SEEDS];
        for(const c of data.seeds){
          if(!merged.some(m=>m.topic===c.topic && m.q===c.q)) merged.push(c);
        }
        MASTER = ensureMinPerTopic(merged, MIN_PER_TOPIC);
      }
      rebuildDeck();
      status.textContent = 'Imported ✔️';
      status.className = 'ok tiny';
    }catch(err){
      status.textContent = 'Import failed';
      status.className = 'danger tiny';
    }
    setTimeout(()=>{ status.textContent=''; }, 2500);
  });
});
</script>
</body>
</html>
